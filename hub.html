<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beb√© Arredondo von Oppersdorff üë∂</title>
    <style>
        :root {
            --primary: #2563eb;
            --success: #16a34a;
            --warning: #ca8a04;
            --danger: #dc2626;
            --bg: #ffffff;
            --card: #f8fafc;
            --text: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg); color: var(--text); line-height: 1.5; }
        .container { max-width: 1000px; margin: 0 auto; padding: 15px; }
        .header { text-align: center; padding: 20px 0; border-bottom: 2px solid var(--border); margin-bottom: 20px; }
        .header h1 { font-size: 1.6em; margin-bottom: 5px; }
        .header .subtitle { color: var(--text-muted); font-size: 0.9em; }
        .week-badge { display: inline-block; background: var(--primary); color: white; padding: 5px 14px; border-radius: 15px; font-weight: 600; font-size: 0.85em; margin-top: 10px; }
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px; }
        .stat-card { background: var(--card); border-radius: 10px; padding: 12px; text-align: center; border: 1px solid var(--border); }
        .stat-number { font-size: 1.5em; font-weight: 700; color: var(--primary); }
        .stat-label { color: var(--text-muted); font-size: 0.8em; }
        .progress-container { background: var(--card); border-radius: 10px; padding: 15px; margin-bottom: 20px; border: 1px solid var(--border); }
        .progress-header { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.85em; }
        .progress-bar { height: 8px; background: var(--border); border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--primary); border-radius: 4px; transition: width 0.3s; }
        .tabs { display: flex; gap: 6px; margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 8px; flex-wrap: wrap; }
        .tab { padding: 8px 14px; background: transparent; border: none; border-radius: 6px; cursor: pointer; font-weight: 500; font-size: 0.85em; color: var(--text-muted); }
        .tab:hover { background: var(--card); }
        .tab.active { background: var(--primary); color: white; }
        .section { display: none; }
        .section.active { display: block; }
        .category-card { background: var(--card); border-radius: 10px; margin-bottom: 10px; border: 1px solid var(--border); overflow: hidden; }
        .category-header { padding: 12px 15px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; font-weight: 600; font-size: 0.95em; }
        .category-header:hover { background: #f1f5f9; }
        .category-body { display: none; padding: 0 15px 12px; }
        .category-body.open { display: block; }
        .product { display: flex; align-items: center; padding: 10px; background: white; border-radius: 6px; margin-bottom: 6px; border: 1px solid var(--border); font-size: 0.9em; }
        .product input[type="checkbox"] { width: 18px; height: 18px; margin-right: 10px; accent-color: var(--primary); flex-shrink: 0; }
        .product-info { flex: 1; min-width: 0; }
        .product-name { font-weight: 500; }
        .product-details { color: var(--text-muted); font-size: 0.8em; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .product-price { font-weight: 600; color: var(--success); margin: 0 8px; font-size: 0.85em; white-space: nowrap; }
        .product-link { color: var(--primary); text-decoration: none; padding: 4px 8px; border-radius: 4px; background: #eff6ff; font-size: 0.8em; white-space: nowrap; }
        .product-link:hover { background: var(--primary); color: white; }
        .product.checked { opacity: 0.5; }
        .product.checked .product-name { text-decoration: line-through; }
        .export-btn { position: fixed; bottom: 15px; right: 15px; background: var(--primary); color: white; border: none; padding: 10px 16px; border-radius: 8px; font-weight: 500; cursor: pointer; font-size: 0.85em; box-shadow: 0 2px 10px rgba(37, 99, 235, 0.3); }
        .filter-bar { display: flex; gap: 8px; margin-bottom: 15px; flex-wrap: wrap; }
        .filter-btn { padding: 6px 12px; background: var(--card); border: 1px solid var(--border); border-radius: 6px; cursor: pointer; font-size: 0.8em; }
        .filter-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
        .search-box { flex: 1; min-width: 150px; padding: 8px 12px; border: 1px solid var(--border); border-radius: 6px; font-size: 0.85em; }
        .timeline-week { background: var(--card); border-radius: 8px; padding: 12px 15px; margin-bottom: 8px; border: 1px solid var(--border); }
        .timeline-week.current { border-color: var(--primary); border-width: 2px; }
        .week-header { display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 0.9em; }
        .week-title { font-weight: 600; }
        .week-dates { color: var(--text-muted); }
        .week-tasks { display: flex; flex-wrap: wrap; gap: 4px; }
        .task-tag { background: white; border: 1px solid var(--border); padding: 3px 8px; border-radius: 4px; font-size: 0.8em; }
        .task-tag.medical { background: #fef2f2; border-color: #fecaca; color: #dc2626; }
        .task-tag.education { background: #eff6ff; border-color: #bfdbfe; color: #1d4ed8; }
        .task-tag.purchase { background: #f0fdf4; border-color: #bbf7d0; color: #16a34a; }
        .task-tag.prep { background: #fefce8; border-color: #fef08a; color: #ca8a04; }
        @media (max-width: 600px) { .stats-grid { grid-template-columns: repeat(2, 1fr); } .product { flex-wrap: wrap; } .product-price, .product-link { margin-top: 5px; } }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>üë∂ Beb√© Arredondo von Oppersdorff</h1>
            <p class="subtitle">Lista Maestra Consolidada</p>
            <div class="week-badge">Semana 26 ¬∑ 98 d√≠as</div>
        </header>
        <div class="stats-grid">
            <div class="stat-card"><div class="stat-number" id="totalItems">0</div><div class="stat-label">Total Items</div></div>
            <div class="stat-card"><div class="stat-number" id="itemsLeft">0</div><div class="stat-label">Pendientes</div></div>
            <div class="stat-card"><div class="stat-number" id="totalCost">$0</div><div class="stat-label">Estimado</div></div>
            <div class="stat-card"><div class="stat-number" id="completion">0%</div><div class="stat-label">Completo</div></div>
        </div>
        <div class="progress-container">
            <div class="progress-header"><span>Progreso</span><span id="progressPercent">0%</span></div>
            <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width: 0%"></div></div>
        </div>
        <div class="tabs">
            <button class="tab active" data-tab="compras">üõí Compras</button>
            <button class="tab" data-tab="hospital">üè• Hospital</button>
            <button class="tab" data-tab="mama">üë© Mam√°</button>
            <button class="tab" data-tab="timeline">üìÖ Timeline</button>
        </div>
        <div class="section active" id="compras">
            <div class="filter-bar">
                <input type="text" class="search-box" placeholder="Buscar..." id="searchBox" oninput="filterItems()">
                <button class="filter-btn active" data-filter="all" onclick="setFilter('all')">Todos</button>
                <button class="filter-btn" data-filter="pending" onclick="setFilter('pending')">Pendientes</button>
                <button class="filter-btn" data-filter="done" onclick="setFilter('done')">Comprados</button>
            </div>
            <div id="shoppingContainer"></div>
        </div>
        <div class="section" id="hospital"><div id="hospitalContainer"></div></div>
        <div class="section" id="mama"><div id="mamaContainer"></div></div>
        <div class="section" id="timeline"><div id="timelineContainer"></div></div>
    </div>
    <button class="export-btn" onclick="exportData()">üì• Exportar CSV</button>

<script>
const data = {
    compras: {
        "dormir": { emoji: "üõèÔ∏è", title: "Dormir / Habitaci√≥n", items: [
            { n: "Cuna Convertible ESQUIMAL 3-en-1", d: "125x65cm ¬∑ Madera", p: "$5,699", l: "https://www.amazon.com.mx/dp/B0BXKQVP8C", pri: "essential" },
            { n: "Bassinet Muja Colecho Multifuncional", d: "‚≠ê4.7 ¬∑ Mosquitero + mecedora", p: "$2,659", l: "https://www.amazon.com.mx/dp/B0D2NP22Q2", pri: "essential" },
            { n: "Colch√≥n Cuna LOLOKID 60x120", d: "Hipoalerg√©nico ¬∑ Doble capa", p: "$1,199", l: "https://www.amazon.com.mx/dp/B0BXKQVP8C" },
            { n: "Protector Colch√≥n Impermeable Nap Baby", d: "70x130cm", p: "$549", l: "https://www.amazon.com.mx/dp/B0D7DMKZ1N" },
            { n: "S√°banas Ajustables Cuna (3)", d: "Algod√≥n", p: "$450" },
            { n: "S√°banas Planas Algod√≥n (4)", d: "Para swaddling", p: "$400" },
            { n: "Mantas Algod√≥n Waffle (4-6)", d: "Jo Frost rec.", p: "$600" },
            { n: "Manta C√°lida Invierno (1)", d: "", p: "$300" },
            { n: "Saco para Dormir", d: "Seg√∫n clima", p: "$450" },
            { n: "Monitor HelloBaby 4\"", d: "‚≠ê4.3 ¬∑ Sin WiFi ¬∑ Visi√≥n nocturna", p: "$1,215", l: "https://www.amazon.com.mx/dp/B0BL3NPJNC" },
            { n: "C√≥moda 6 Cajones Storkcraft", d: "‚≠ê4.6 ¬∑ GREENGUARD", p: "$6,749", l: "https://www.amazon.com.mx/dp/B07JN3KXVP", pri: "high" },
            { n: "Mecedora/Silla C√≥moda", d: "Para lactancia", p: "$3,000" },
            { n: "Tapete Foamy MoMat", d: "EVA ¬∑ Para cuarto beb√©", p: "$1,390", l: "https://www.amazon.com.mx/dp/B08XWQF5TJ" },
            { n: "Nidito Port√°til petit nap", d: "Colecho port√°til", p: "$999", l: "https://www.amazon.com.mx/dp/B08XWQF5TJ" },
            { n: "Cambiador Contorneado Ingenuity", d: "Con correa seguridad", p: "$882", l: "https://www.amazon.com.mx/dp/B07JN3KXVP" },
            { n: "Cajones/Canastas Organizadoras", d: "Para pasillo/cuarto", p: "$500" },
            { n: "Cortinas Blackout (2)", d: "Cuarto + rec√°mara", p: "$1,200" },
            { n: "Dimmer Switch", d: "Para cuarto beb√©", p: "$300" },
            { n: "Luz Roja Nocturna", d: "Para lactancia nocturna", p: "$250" },
            { n: "Term√≥metro/Higr√≥metro Ambiente", d: "Digital", p: "$200" }
        ]},
        "panales": { emoji: "üß∑", title: "Pa√±ales / Cambio", items: [
            { n: "Pa√±ales Huggies RN (2 paq)", d: "‚≠ê4.9 (7,199) ¬∑ 40pz c/u", p: "$318", l: "https://www.amazon.com.mx/dp/B01MSSUR4Q", pri: "essential" },
            { n: "Toallitas WaterWipes (540)", d: "‚≠ê4.7 (53,022) ¬∑ 99.9% agua", p: "$773", l: "https://www.amazon.com.mx/dp/B008KJQMA0", pri: "essential" },
            { n: "Cambiador Port√°til", d: "Para salidas", p: "$349", l: "https://www.amazon.com.mx/dp/B0BJ8C7GNH" },
            { n: "Crema Rozaduras Desitin", d: "‚≠ê4.8 ¬∑ 40% zinc", p: "$159", l: "https://www.amazon.com.mx/dp/B00PS7G9XM", pri: "essential" },
            { n: "Diaper Genie Compact", d: "‚≠ê4.7 (6,546) ¬∑ Herm√©tico", p: "$762", l: "https://www.amazon.com.mx/dp/B0B9H9MTVY" },
            { n: "Bolsas Pa√±ales Sucios", d: "Con fragancia ¬∑ Jo Frost rec.", p: "$150" },
            { n: "Burp Cloths / Pa√±ales Tela (6-10)", d: "Jo Frost + Gina Ford rec.", p: "$300", pri: "high" }
        ]},
        "alimentacion": { emoji: "üçº", title: "Alimentaci√≥n / Lactancia", items: [
            { n: "Jeringas Calostro", d: "Para recolecci√≥n previa", p: "$200", pri: "essential" },
            { n: "Biberones Dr. Brown's Antic√≥licos", d: "‚≠ê4.8 (2,000+)", p: "$1,299", l: "https://www.amazon.com.mx/dp/B07SR5H23S" },
            { n: "Esterilizador Philips Avent 3-en-1", d: "‚≠ê4.8 ¬∑ Esteriliza+seca", p: "$2,499", l: "https://www.amazon.com.mx/dp/B08FD8VRYZ" },
            { n: "Cepillo para Biberones", d: "Jo Frost rec. ¬∑ D√≠a 1", p: "$100", pri: "high" },
            { n: "Extractor Spectra S2", d: "‚≠ê4.8 (15,000+) ¬∑ Hospitalario", p: "$4,999", l: "https://www.amazon.com.mx/dp/B00BLBLR1I" },
            { n: "Almohada Lactancia", d: "V-shaped o T-shaped", p: "$600" },
            { n: "Brasier Lactancia (3-4)", d: "Sin underwire", p: "$800" },
            { n: "Discos Protectores Lactancia", d: "Desechables o reutilizables", p: "$200" }
        ]},
        "bano": { emoji: "üõÅ", title: "Ba√±o / Higiene", items: [
            { n: "Ba√±era ESQUIMAL Plegable", d: "‚≠ê4.7 ¬∑ Con term√≥metro", p: "$989", l: "https://www.amazon.com.mx/dp/B0CKS73X73" },
            { n: "Toallas con Capucha (2-4)", d: "Algod√≥n", p: "$500" },
            { n: "Cotonetes Beb√©", d: "Uso externo", p: "$50" },
            { n: "Algod√≥n", d: "Para limpieza", p: "$50" },
            { n: "Jab√≥n Cetaphil Baby 399ml", d: "‚≠ê4.8 ¬∑ 2-en-1", p: "$379", l: "https://www.amazon.com.mx/dp/B09JL9NGMB" },
            { n: "Shampoo Suave Beb√©", d: "Sin l√°grimas", p: "$150" },
            { n: "Cortau√±as Beb√©", d: "Punta redondeada", p: "$100" },
            { n: "Sterimar / Suero Nasal", d: "Para congesti√≥n", p: "$180" },
            { n: "Gasas Est√©riles", d: "Uso general", p: "$80" },
            { n: "Jab√≥n ZOTE Hojuelas", d: "Para lavar ropa", p: "$50" },
            { n: "Aceite Oliva Beb√©", d: "Jo Frost ¬∑ Costra l√°ctea", p: "$200" },
            { n: "Cepillo Cabello Suave", d: "Jo Frost rec.", p: "$100" },
            { n: "Crema Masaje Beb√©", d: "Para bonding", p: "$200" }
        ]},
        "ropa": { emoji: "üëï", title: "Ropa Beb√©", items: [
            { n: "Bodies / Onesies (8-10)", d: "Con snaps", p: "$600", pri: "essential" },
            { n: "Calcetines / Botitas (5-8 pares)", d: "", p: "$250" },
            { n: "Gorrito Algod√≥n (3)", d: "", p: "$150" },
            { n: "Gorro Temporada", d: "Seg√∫n clima", p: "$150" },
            { n: "Mamelucos / Sleepers (6)", d: "", p: "$600" },
            { n: "Su√©teres / Chamarras (2-3)", d: "", p: "$450" },
            { n: "Baberos (4-8)", d: "", p: "$200" },
            { n: "Trapitos / Toallitas (5-8)", d: "", p: "$200" },
            { n: "Playeras (opcional)", d: "", p: "$200" },
            { n: "Pantalones (opcional)", d: "", p: "$200" },
            { n: "Sombrero con Ala", d: "Jo Frost ¬∑ Para 3+ meses", p: "$200" }
        ]},
        "transporte": { emoji: "üöó", title: "Transporte / Paseos", items: [
            { n: "Car Seat Graco Extend2Fit", d: "Rear+forward ¬∑ Hasta 7 a√±os", p: "$5,447", l: "https://www.amazon.com.mx/dp/B019EFMJH8", pri: "essential" },
            { n: "Protector Asiento Meolsaek", d: "600D impermeable", p: "$230", l: "https://www.amazon.com.mx/dp/B07JN3KXVP" },
            { n: "Espejo Retrovisor Beb√© Shynerk", d: "Vista amplia", p: "$325", l: "https://www.amazon.com.mx/dp/B07JN3KXVP" },
            { n: "Carriola", d: "Posici√≥n plana 0-6m", p: "$4,000" },
            { n: "Portabeb√© BabyBj√∂rn Mini", d: "‚≠ê4.8 ¬∑ 0-12 meses", p: "$1,686", l: "https://www.amazon.com.mx/dp/B07JN3KXVP" },
            { n: "Pa√±alera", d: "Para salidas", p: "$500" }
        ]},
        "salud": { emoji: "üè•", title: "Salud", items: [
            { n: "Term√≥metro Digital Rectal", d: "Jo Frost rec.", p: "$200" },
            { n: "Term√≥metro iHealth 3-en-1", d: "‚≠ê4.7 ¬∑ Sin contacto", p: "$1,050", l: "https://www.amazon.com.mx/dp/B0C8JGQSGN" },
            { n: "Vaselina", d: "Para term√≥metro rectal", p: "$60", pri: "high" },
            { n: "Gel Antibacterial", d: "Para pa√±alera", p: "$60" }
        ]},
        "equipo": { emoji: "üé†", title: "Equipo Adicional", items: [
            { n: "Bouncer Maxi-Cosi Loa", d: "0-9kg ¬∑ 0-6 meses", p: "$2,094", l: "https://www.amazon.com.mx/dp/B07JN3KXVP" },
            { n: "Columpio Beb√©", d: "Opcional", p: "$1,500" },
            { n: "Chup√≥n / Pacificador", d: "Opcional ¬∑ Sleep aid", p: "$200" },
            { n: "Calentador Agua", d: "Cocina/lavadora", p: "$2,000" },
            { n: "Sof√° Nuevo", d: "Sala", p: "$8,000" },
            { n: "Tarjetas Blanco/Negro", d: "Estimulaci√≥n visual", p: "$150" }
        ]}
    },
    hospital: {
        "mama": { emoji: "üë©", title: "Hospital - Mam√°", items: [
            { n: "Calzones Holgados (3)", d: "C√≥modos", p: "" },
            { n: "Brasieres Lactancia (2)", d: "", p: "" },
            { n: "Pa√±ales Tena / Frida Mom", d: "Sangrado postparto", p: "$200" },
            { n: "Camisones Abertura Delantera (1-2)", d: "Para lactancia", p: "" },
            { n: "Sandalias Pl√°stico", d: "Para ducha", p: "" },
            { n: "Ropa Salida", d: "C√≥moda", p: "" },
            { n: "Zapatos C√≥modos", d: "", p: "" },
            { n: "Cosmetiquera", d: "Higiene personal", p: "" },
            { n: "Documentos", d: "Plan Nacimiento, Seguro, An√°lisis, IDs", p: "", pri: "essential" },
            { n: "Dinero / Tarjeta", d: "", p: "" },
            { n: "Celular + Cargador", d: "", p: "" }
        ]},
        "parto": { emoji: "ü§∞", title: "Hospital - Trabajo de Parto", items: [
            { n: "Fitball / Pelota Pilates", d: "75cm", p: "$350" },
            { n: "Aceites Esenciales + Difusor", d: "Aromaterapia", p: "$400" },
            { n: "Masajeador / Pelotas", d: "", p: "$200" },
            { n: "Playlist Relajante", d: "Preparar antes", p: "" },
            { n: "Im√°genes / Frases Motivacionales", d: "", p: "" },
            { n: "Rebozo", d: "", p: "$300" },
            { n: "Compresas Fr√≠o-Calor", d: "", p: "$200" },
            { n: "Ventilador / Abanico", d: "", p: "$150" },
            { n: "Snacks y Fruta", d: "", p: "$200" },
            { n: "Botella Agua con Popote", d: "", p: "$100" },
            { n: "Agua de Coco", d: "", p: "$100" },
            { n: "Juegos / Revistas", d: "Pasatiempos", p: "" }
        ]},
        "bebe": { emoji: "üë∂", title: "Hospital - Beb√©", items: [
            { n: "Jeringas con Calostro", d: "Recolectado previamente", p: "", pri: "essential" },
            { n: "Pa√±ales RN (1 paq)", d: "", p: "$160" },
            { n: "Toallitas H√∫medas", d: "", p: "$100" },
            { n: "Cortau√±as Beb√©", d: "", p: "$100" },
            { n: "Cobijitas (2)", d: "", p: "$300" },
            { n: "Car Seat", d: "Obligatorio para alta", p: "", pri: "essential" }
        ]}
    },
    mama: {
        "postparto": { emoji: "üí™", title: "Mam√° - Postparto / Recuperaci√≥n", items: [
            { n: "Pa√±ales Tena / Frida Mom", d: "Sangrado postparto", p: "$250" },
            { n: "Calzones Compresi√≥n Postparto", d: "", p: "$400" },
            { n: "Toallas Femeninas D√≠a Tena/M√≠a", d: "", p: "$150" },
            { n: "Toallas Femeninas Nocturnas", d: "", p: "$150" },
            { n: "Banquito para Ba√±o", d: "Apoyo", p: "$200" }
        ]},
        "lactancia": { emoji: "ü§±", title: "Mam√° - Lactancia", items: [
            { n: "Brasier Lactancia (varios)", d: "Sin underwire", p: "$600" },
            { n: "Discos Protectores Lactancia", d: "Reutilizables/desechables", p: "$200" },
            { n: "Ropa de Lactancia", d: "C√≥moda", p: "$800" },
            { n: "Extractor de Leche", d: "Manual o el√©ctrico", p: "$4,999" },
            { n: "Almohada Lactancia", d: "V o T-shaped", p: "$600" },
            { n: "Silla C√≥moda Lactancia", d: "", p: "$3,000" }
        ]},
        "otro": { emoji: "üßò", title: "Mam√° - Otro", items: [
            { n: "Fitball 75cm", d: "Para ejercicios", p: "$350" }
        ]}
    }
};

const timeline = [
    { week: 26, dates: "26 Ene - 1 Feb", tasks: [
        { t: "Doula Sandy", type: "education" }, { t: "Doula Gaby", type: "education" },
        { t: "HIP Doula Lucy 7pm", type: "education" }, { t: "IMSS inscripci√≥n", type: "medical" },
        { t: "Lab tests", type: "medical" }, { t: "Pelota 75cm", type: "purchase" }
    ]},
    { week: 27, dates: "2 - 8 Feb", tasks: [
        { t: "Videos MOM Center", type: "education" }, { t: "Cita IMSS 8:45AM", type: "medical" },
        { t: "Amazon Orden #1", type: "purchase" }
    ]},
    { week: 28, dates: "9 - 15 Feb", tasks: [{ t: "VACUNA", type: "medical" }, { t: "Doula Sandy HIP?", type: "education" }]},
    { week: 29, dates: "16 - 22 Feb", tasks: [{ t: "Borrador PDN", type: "prep" }, { t: "Dr. Edwin + Preguntas", type: "medical" }]},
    { week: 30, dates: "23 Feb - 1 Mar", tasks: [{ t: "BabyCenter App", type: "prep" }, { t: "Amazon Orden #2", type: "purchase" }]},
    { week: 31, dates: "2 - 8 Mar", tasks: [{ t: "Plan Postparto", type: "prep" }]},
    { week: 32, dates: "9 - 15 Mar", tasks: []},
    { week: 33, dates: "16 - 22 Mar", tasks: [{ t: "Valores Familiares", type: "prep" }]},
    { week: 34, dates: "23 - 29 Mar", tasks: [{ t: "Curso online (Beni+Noemi)", type: "education" }]},
    { week: 35, dates: "30 Mar - 5 Abr", tasks: [{ t: "Tarjetas B/N", type: "purchase" }, { t: "Comidas congeladas", type: "prep" }]},
    { week: 36, dates: "6 - 12 Abr", tasks: [{ t: "Docs Seguro", type: "prep" }, { t: "Confirmaci√≥n Hospital", type: "medical" }]},
    { week: 37, dates: "13 - 19 Abr", tasks: []},
    { week: 38, dates: "20 - 26 Abr", tasks: [{ t: "Dentista SvO", type: "medical" }, { t: "Iniciar Calostro", type: "medical" }]},
    { week: 39, dates: "27 Abr - 3 May", tasks: [{ t: "Calostro diario", type: "medical" }]},
    { week: 40, dates: "4 - 10 May", tasks: [{ t: "¬°Fecha estimada! üéâ", type: "prep" }]}
];

let currentFilter = 'all';
let searchTerm = '';

function render() {
    renderSection('compras', 'shoppingContainer');
    renderSection('hospital', 'hospitalContainer');
    renderSection('mama', 'mamaContainer');
    renderTimeline();
    loadState();
    updateStats();
}

function renderSection(section, containerId) {
    const container = document.getElementById(containerId);
    container.innerHTML = Object.entries(data[section]).map(([k, c]) => `
        <div class="category-card">
            <div class="category-header" onclick="this.nextElementSibling.classList.toggle('open')">
                <span>${c.emoji} ${c.title}</span>
                <span style="color:var(--text-muted);font-size:0.85em">${c.items.length} items</span>
            </div>
            <div class="category-body">${c.items.map((it, i) => `
                <div class="product ${it.pri === 'essential' ? 'essential' : ''}" id="p-${section}-${k}-${i}" data-name="${it.n.toLowerCase()}" data-cat="${k}">
                    <input type="checkbox" onchange="toggle('p-${section}-${k}-${i}')">
                    <div class="product-info">
                        <div class="product-name">${it.pri === 'essential' ? '‚≠ê ' : ''}${it.n}</div>
                        ${it.d ? `<div class="product-details">${it.d}</div>` : ''}
                    </div>
                    ${it.p ? `<div class="product-price">${it.p}</div>` : ''}
                    ${it.l ? `<a href="${it.l}" target="_blank" class="product-link">Ver</a>` : ''}
                </div>
            `).join('')}</div>
        </div>
    `).join('');
}

function renderTimeline() {
    document.getElementById('timelineContainer').innerHTML = timeline.map(w => `
        <div class="timeline-week ${w.week === 26 ? 'current' : ''}">
            <div class="week-header">
                <span class="week-title">Semana ${w.week}${w.week === 26 ? ' ‚Üê Actual' : ''}</span>
                <span class="week-dates">${w.dates}</span>
            </div>
            <div class="week-tasks">${w.tasks.length ? w.tasks.map(t => `<span class="task-tag ${t.type}">${t.t}</span>`).join('') : '<span class="task-tag">‚Äî</span>'}</div>
        </div>
    `).join('');
}

function toggle(id) {
    const el = document.getElementById(id);
    el.classList.toggle('checked');
    el.querySelector('input').checked = el.classList.contains('checked');
    saveState();
    updateStats();
}

function updateStats() {
    const all = document.querySelectorAll('.product');
    const done = document.querySelectorAll('.product.checked');
    const total = all.length;
    const completed = done.length;
    const pct = total ? Math.round((completed / total) * 100) : 0;
    
    let cost = 0;
    all.forEach(el => {
        if (!el.classList.contains('checked')) {
            const price = el.querySelector('.product-price');
            if (price) {
                const val = parseInt(price.textContent.replace(/[$,]/g, '')) || 0;
                cost += val;
            }
        }
    });
    
    document.getElementById('totalItems').textContent = total;
    document.getElementById('itemsLeft').textContent = total - completed;
    document.getElementById('totalCost').textContent = '$' + (cost > 1000 ? Math.round(cost/1000) + 'K' : cost);
    document.getElementById('completion').textContent = pct + '%';
    document.getElementById('progressPercent').textContent = pct + '%';
    document.getElementById('progressFill').style.width = pct + '%';
}

function saveState() {
    const checked = [...document.querySelectorAll('.product.checked')].map(e => e.id);
    localStorage.setItem('bebe-avo-master', JSON.stringify(checked));
}

function loadState() {
    const saved = localStorage.getItem('bebe-avo-master');
    if (saved) {
        JSON.parse(saved).forEach(id => {
            const el = document.getElementById(id);
            if (el) { el.classList.add('checked'); el.querySelector('input').checked = true; }
        });
    }
}

function setFilter(filter) {
    currentFilter = filter;
    document.querySelectorAll('.filter-btn').forEach(b => b.classList.toggle('active', b.dataset.filter === filter));
    filterItems();
}

function filterItems() {
    searchTerm = document.getElementById('searchBox').value.toLowerCase();
    document.querySelectorAll('.product').forEach(el => {
        const name = el.dataset.name;
        const isChecked = el.classList.contains('checked');
        const matchSearch = !searchTerm || name.includes(searchTerm);
        const matchFilter = currentFilter === 'all' || (currentFilter === 'done' && isChecked) || (currentFilter === 'pending' && !isChecked);
        el.style.display = matchSearch && matchFilter ? 'flex' : 'none';
    });
}

function exportData() {
    let csv = 'Categor√≠a,Producto,Detalles,Precio,Estado,Link\n';
    document.querySelectorAll('.product').forEach(el => {
        const name = el.querySelector('.product-name').textContent.replace('‚≠ê ', '');
        const details = el.querySelector('.product-details')?.textContent || '';
        const price = el.querySelector('.product-price')?.textContent || '';
        const link = el.querySelector('.product-link')?.href || '';
        const status = el.classList.contains('checked') ? 'Comprado' : 'Pendiente';
        const cat = el.dataset.cat;
        csv += `"${cat}","${name}","${details}","${price}","${status}","${link}"\n`;
    });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(new Blob([csv], { type: 'text/csv;charset=utf-8;' }));
    a.download = `Bebe_AVO_Master_${new Date().toISOString().slice(0,10)}.csv`;
    a.click();
}

document.querySelectorAll('.tab').forEach(t => t.onclick = () => {
    document.querySelectorAll('.tab, .section').forEach(e => e.classList.remove('active'));
    t.classList.add('active');
    document.getElementById(t.dataset.tab).classList.add('active');
});

render();
</script>
</body>
</html>
